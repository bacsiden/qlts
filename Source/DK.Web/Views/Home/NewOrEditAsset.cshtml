@using DK.Application.Models
@model TaiSan
@{
    ViewBag.Title = Model.Id != Guid.Empty ? "Chỉnh sửa tài sản" : "Thêm mới tài sản";
    var canManage = DK.Application.Models.RoleList.GetAll().Any(User.IsInRole);
}

<style>
    .search-item {
        margin-bottom: 10px;
    }

        .search-item label {
            margin-bottom: 0;
        }
</style>

@using (Html.BeginForm(null, null, FormMethod.Post, new { role = "form", id = "frmAsset" }))
{
    <div class="card mt-2 mb-2 shadow-base">
        <div class="card-body">
            @Html.Partial("_NewOrEditAssetForm", Model)
        </div>
    </div>
    <h4 class="mt-3">
        Danh sách tài sản con
    </h4>
    <div class="mb-1">
        <a href="javascript:void(0)" onclick="addChildAsset();" class="btn btn-primary btn-sm mr-1"><i class="fa fa-plus"></i> Thêm tài sản con</a>
        <a class="btn btn-sm btn-danger pointer" onclick="removeTaiSanChild();" href="javascript:void(0)"><i class="fa fa-times"></i> Xóa tài sản con</a>
    </div>
    <div class="card shadow-base mb-2 bd-0">
        <div class="table-responsive">
            @Html.Partial("_TableChild", Model.Children)
        </div>
    </div>
    <button class="btn btn-sm bd bg-primary tx-white pointer" onclick="return submitEditAsset();"><i class="fa fa-save"></i> Lưu lại</button>
}


@section Scripts {
    <link href="@Url.Content("~/Content/lib/select2/css/select2-bootstrap.min.css")" rel="stylesheet">
    <script src="~/Content/lib/select2/js/select2.min.js"></script>
    <script src="~/Scripts/common.js"></script>
    <script>
        $(document).ready(function () {
            var activeClass = "@(Model.IsApproved ? "asset-approved": "asset-unapproved")";
            reActiveMenu(activeClass);
        });

        function reActiveMenu(activeClass) {
            $("#LeftMenu a.asset").removeClass('active');
            $("#LeftMenu a." + activeClass).addClass('active');
        }

        function removeTaiSanChild() {
            if ($(".checkitem:checked").length === 0) {
                return false;
            }

            if (!confirm("Bạn có chắc muốn xóa?")) {
                return false;
            }

            $(".checkitem:checked").closest("tr").remove();
            resetTableNumber();
            return false;
        }

        function resetTableNumber() {
            $(".checkitem").each(function (index, item) {
                $(item).closest("td").next().html(index + 1);
            });
        }
    </script>
}
